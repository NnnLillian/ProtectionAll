<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <link href="images/favicon.png" rel="shortcut icon" type="image/png">

    <title>方案库-装备保障方案</title>

    <link href="css/style.default.css" rel="stylesheet">
    <link href="css/jquery.datatables.css" rel="stylesheet">
    <!-- datepicker -->
    <link href='css/core.css' rel='stylesheet' type='text/css'>

    <link href="css/bootstrap-select.css" rel="stylesheet">
    <link href="css/bootstrap-table.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->

    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/jquery-migrate-1.2.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/modernizr.min.js"></script>
    <script src="js/jquery.sparkline.min.js"></script>
    <script src="js/toggles.min.js"></script>
    <script src="js/retina.min.js"></script>
    <script src="js/jquery.cookies.js"></script>

    <script src="js/select2.min.js"></script>

    <script src="js/custom.js"></script>
    <script src="js/when.js"></script>
    <script src="js/sweetalert.min.js"></script>
    <script src="js/bootstrap-select.js"></script>
</head>

<body>
<!-- Preloader -->
<div id="preloader">
    <div id="status"><i class="fa fa-spinner fa-spin"></i></div>
</div>


<section>

    <div class="left"></div>

    <div class="mainpanel">

        <div class="head"></div><!-- headerbar -->

        <div class="pageheader">
            <h2><i class="fa  fa-edit"></i> 保障方案编辑</h2>
            <div class="breadcrumb-wrapper">
                <span class="label">当前位置:</span>
                <ol class="breadcrumb">
                    <li><a href="#">装备保障系统</a></li>
                    <li class="active">编辑保障方案</li>
                </ol>
            </div>
        </div>

        <div class="contentpanel">

            <form class="form-horizontal" id="basicForm1">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-btns">
                            <!--<a href="" class="panel-close">&times;</a>-->
                            <!--<a href="" class="minimize">&minus;</a>-->
                        </div>
                        <h4 class="panel-title">作战任务</h4>
                        <p></p>
                    </div>
                    <div class="panel-body">
                        <h3>作战基本信息</h3>
                        <div class="form-group dropdown">
                            <label class="col-sm-3 control-label">任务类型 <span class="asterisk">*</span></label>
                            <div class="col-sm-2">
                                <select class="form-control selectpicker show-tick" id="schemeType">
                                    <option value="1">威慑拒止</option>
                                    <option value="2">轻度对抗</option>
                                    <option value="3">防袭扰侦察</option>
                                </select>
                            </div>

                            <label class="col-sm-2 control-label">作战方向 <span class="asterisk">*</span></label>
                            <div class="col-sm-2">
                                <select class="form-control selectpicker show-tick" id="schemeDirection">
                                    <option value="1">中韩方向</option>
                                    <option value="2">首都方向</option>
                                    <option value="3">东海方向</option>
                                    <option value="4">中印方向</option>
                                    <option value="5">台海方向</option>
                                    <option value="6">南海方向</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">布防地点 <span class="asterisk">*</span></label>
                            <div class="col-sm-6">
                                <div class="required" style="width: 30%; display: inline-block">
                                    <!-- 经度 -->
                                    <input class="form-control" id="longitude" onchange="if(!/^(\-|\+)?(((\d|[1-9]\d|1[0-7]\d|0{1,3})\.\d{0,6})|(\d|[1-9]\d|1[0-7]\d|0{1,3})|180\.0{0,6}|180)$/.test(this.value)){alert('经度范围：-180~180（只支持保留小数点后六位）');this.value='';}"
                                           placeholder="经度" required
                                           type="text"/>

                                </div>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <div class="required" style="width: 30%; display: inline-block">
                                    <!-- 纬度 -->
                                    <input class="form-control" id="latitude" onchange="if(!/^(\-|\+)?([0-8]?\d{1}\.\d{0,6}|90\.0{0,6}|[0-8]?\d{1}|90)$/.test(this.value)){alert('纬度范围：-90~90（只支持保留小数点后六位）');this.value='';}" placeholder="纬度"
                                           required
                                           type="text"/>

                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="required">
                                <label class="col-sm-3 control-label">任务名称（代号） <span class="asterisk">*</span></label>
                                <div class="col-sm-2">
                                    <input class="form-control" id="schemeCode" placeholder="任务名称（代号）"
                                           required type="text"/>
                                </div>
                            </div>
                            <div class="required">
                                <label class="col-sm-2 control-label">起止时间 <span class="asterisk">*</span></label>
                                <div class="col-sm-2">
                                    <input class="form-control" id="date" placeholder="起止时间" required/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">作战单位名称 <span class="asterisk">*</span></label>
                            <div class="col-sm-2">
                                <select class="form-control selectpicker show-tick " id="platoonId">
                                    <th:block th:each="item:${platoon_list}">
                                        <option th:text="${item.getPlatoon_name()}" th:value="${item.getPlatoon_id()}">
                                            十二旅
                                        </option>
                                    </th:block>
                                </select>
                            </div>
                            <!--<label class="col-sm-2 control-label">梯队数量</label>-->
                            <!--<div class="col-sm-2">-->
                            <!--<input type="number" class="form-control" placeholder="1" id="actionGroupCount"-->
                            <!--onkeyup="if (this.value.length==1){ this.value=this.value.replace(/[^1-9]/g,'')}else {this.value=this.value.replace(/\D/g,'')}"-->
                            <!--onchange="if (this.value.length==1){ this.value=this.value.replace(/[^1-9]/g,'')}else {this.value=this.value.replace(/\D/g,'')}"-->
                            <!--/>-->
                            <!--</div>-->
                            <label class="col-sm-2 control-label">是否兵分多路<span class="asterisk">*</span> </label>
                            <div class="col-sm-2">
                                <div class="rdio rdio-success">
                                    <input id="yesForActionGroups" name="action" required type="radio" value="1"/>
                                    <label for="yesForActionGroups">是</label>
                                </div>
                                <div class="rdio rdio-success">
                                    <input id="noForActionGroups" name="action" required type="radio" value="0"/>
                                    <label for="noForActionGroups">否</label>
                                </div>
                                <label class="error"></label>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-sm-12 col-sm-offset-3" style="text-align: center; margin: 0 auto">
                                    <!--<button class="btn btn-primary">保存</button>&nbsp;-->
                                    <button class="btn btn-primary" id="newSchemeActionBtn" type="button">保存</button>&nbsp;
                                    <button class="btn btn-default" onclick="javascript:history.go(-1);">
                                        取消
                                    </button>
                                </div>
                            </div>
                        </div><!-- panel-footer -->
                    </div><!-- panel-body -->
                </div><!-- panel -->
            </form>

        </div><!-- contentpanel -->

    </div><!-- mainpanel -->

</section>


<script th:inline="javascript">

    <!-- 加载共同头部 -->

    $('.left').load("left");

    new When({
        input: document.getElementById('date')
    });

    $(function () {
        $('#newSchemeActionBtn').click(function () {
            var schemeType = $('#schemeType option:selected').val();
            var schemeDirection = $('#schemeDirection option:selected').val();
            var longitude = $('#longitude').val();
            var latitude = $('#latitude').val();
            //  将经纬度存入全局变量
            localStorage.setItem("lng", longitude);
            localStorage.setItem("lat", latitude);
            var date = $('#date').val();
            var schemeCode = $('#schemeCode').val();
            var platoonId = $('#platoonId option:selected').val();
            var platoonName = $('#platoonId option:selected').text();
            // var actionGroupCount = parseInt($('#actionGroupCount').val());
            var radio = $('input:radio:checked').val();
            console.log(typeof radio);
            localStorage.setItem("case_position", schemeDirection);
            localStorage.setItem("platoon_id", platoonId);
            localStorage.setItem("platoon_name", platoonName);
            // localStorage.setItem("action_group_count", actionGroupCount);

            //  切割date日期字符串，得到任务开始时间与结束时间
            var dateStr = date.split(' ');
            var schemeBeginTime = dateStr[0];
            var schemeEndTime = dateStr[2];
            console.log(schemeBeginTime);
            console.log(schemeEndTime);

            //  切割任务开始时间字符串，得到开始时间的月份
            var monthStr = schemeBeginTime.split('-');
            var month = monthStr[1];
            localStorage.setItem("month", month);

            var location = {
                longitude: parseFloat(longitude),
                latitude: parseFloat(latitude)
            };
            var scheme = {
                scheme_code: schemeCode,
                combat_direction: schemeDirection,
                scheme_type: schemeType,
                scheme_begin_time: schemeBeginTime,
                scheme_end_time: schemeEndTime,
                // action_group_count: actionGroupCount
                action_group_flag: radio
            };
            var request = {
                location: location,
                scheme: scheme
            };

            var schemeStr = JSON.stringify(request);

            let oneAction_group = {
                action_group_name: "无小分组",
                location: location
            };
            $.ajax({
                type: 'POST',
                data: schemeStr,
                contentType: "application/json;charset=UTF-8",
                url: "/AddSchemeMsg",
                dataType: "json",
                async: false,     // 取消异步加载
                success: function (data) {
                    alert("scheme" + data.scheme_id);
                    if (radio === "0") {
                        $.ajax({
                            type: 'POST',
                            data: JSON.stringify(oneAction_group),
                            contentType: "application/json;charset=UTF-8",
                            url: "/AddActionGroupMsg",
                            dataType: "json",
                            async: false,
                            success: function (data) {
                                localStorage.setItem("onActionGroupId",data.action_group_id)
                                window.location.href = "/edit_people_oneGroup";
                            },
                            error:function () {
                                alert("sorry for add one action group");
                            }
                        });
                    } else {
                        window.location.href = "/edit_people_Groups";
                    }
                    localStorage.setItem("scheme_id", data.scheme_id);
                },
                error: function () {
                    console.error("error");

                }
            })


        })

    })

</script>

</body>
</html>
