<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="images/favicon.png" type="image/png">

    <title>方案库-装备保障方案</title>

    <link href="css/style.default.css" rel="stylesheet">
    <link href="css/jquery.datatables.css" rel="stylesheet">
    <!-- datepicker -->
    <link rel='stylesheet' type='text/css' href='css/core.css'>

    <link rel="stylesheet" href="css/bootstrap-select.css">
    <link rel="stylesheet" type="text/css" href="css/city-picker.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<!-- Preloader -->
<div id="preloader">
    <div id="status"><i class="fa fa-spinner fa-spin"></i></div>
</div>


<section>

    <div class="left"></div>

    <div class="mainpanel">

        <div class="head"></div><!-- headerbar -->

        <div class="pageheader">
            <h2><i class="fa  fa-edit"></i> 保障方案编辑</h2>
            <div class="breadcrumb-wrapper">
                <span class="label">当前位置:</span>
                <ol class="breadcrumb">
                    <li><a href="#">装备保障系统</a></li>
                    <li class="active">编辑保障方案</li>
                </ol>
            </div>
        </div>

        <div class="contentpanel">
            <form id="basicForm" class="form-horizontal">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-btns">
                            <a href="" class="panel-close">&times;</a>
                            <a href="" class="minimize">&minus;</a>
                        </div>
                        <h4 class="panel-title">作战任务</h4>
                        <p></p>
                    </div>
                    <div class="panel-body">
                        <h3>作战任务名称</h3>
                        <div class="form-group dropdown">
                            <label class="col-sm-3 control-label">任务类型 <span class="asterisk">*</span></label>
                            <div class="col-sm-2">
                                <select class="form-control selectpicker show-tick" id="schemeType">
                                    <option value="1">威慑拒止</option>
                                    <option value="2">轻度对抗</option>
                                    <option value="3">放袭扰侦察</option>
                                </select>
                            </div>

                            <label class="col-sm-2 control-label">作战方向 <span class="asterisk">*</span></label>
                            <div class="col-sm-2">
                                <select class="form-control selectpicker show-tick" id="schemeDirection">
                                    <option value="1">中韩方向</option>
                                    <option value="2">首都方向</option>
                                    <option value="3">东海方向</option>
                                    <option value="3">中印方向</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">布防区域 <span class="asterisk">*</span></label>
                            <div class="col-sm-6">
                                <div class="required" style="width: 30%; display: inline-block">
                                    <!-- 经度 -->
                                    <input type="text" class="form-control" id="longitude"
                                           placeholder="经度" required
                                           onchange="if(!/^(\-|\+)?(((\d|[1-9]\d|1[0-7]\d|0{1,3})\.\d{0,6})|(\d|[1-9]\d|1[0-7]\d|0{1,3})|180\.0{0,6}|180)$/.test(this.value)){alert('经度范围：-180~180（只支持保留小数点后六位）');this.value='';}"/>

                                </div>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <div class="required" style="width: 30%; display: inline-block">
                                    <!-- 纬度 -->
                                    <input type="text" class="form-control" placeholder="纬度" id="latitude"
                                           required
                                           onchange="if(!/^(\-|\+)?([0-8]?\d{1}\.\d{0,6}|90\.0{0,6}|[0-8]?\d{1}|90)$/.test(this.value)){alert('纬度范围：-90~90（只支持保留小数点后六位）');this.value='';}"/>

                                </div>
                            </div>
                        </div>
                        <div class="form-group dropdown">
                            <label class="col-sm-3 control-label">携装方式 <span class="asterisk">*</span></label>
                            <div class="col-sm-2">
                                <select class="form-control selectpicker show-tick " id="carryPattern">
                                    <option> 全装</option>
                                    <option> 简装</option>
                                    <option> 其他</option>
                                </select>
                            </div>
                            <label class="col-sm-2 control-label">保障模式 <span class="asterisk">*</span></label>
                            <div class="col-sm-2">
                                <select class="form-control selectpicker show-tick" id="protectionPattern">
                                    <option> 自主保障</option>
                                    <option> 协同保障</option>
                                    <option> 其他</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="required">
                                <label class="col-sm-3 control-label">任务代号 <span class="asterisk">*</span></label>
                                <div class="col-sm-2">
                                    <input id="schemeCode" type="text" class="form-control"
                                           placeholder="任务代号" required/>
                                </div>
                            </div>
                            <div class="required">
                                <label class="col-sm-2 control-label">起止日期 <span class="asterisk">*</span></label>
                                <div class="col-sm-2">
                                    <input id="date" class="form-control" placeholder="起止日期" required/>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <h3>作战队伍</h3>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">队伍名称 <span class="asterisk">*</span></label>
                            <div class="col-sm-2">
                                <select class="form-control selectpicker show-tick " id="platoonId">
                                    <th:block th:each="item:${platoon_list}">
                                        <option th:text="${item.getPlatoon_name()}" th:value="${item.getPlatoon_id()}">
                                            十二旅
                                        </option>
                                    </th:block>
                                </select>
                            </div>
                        </div><!-- panel-body -->

                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-sm-12 col-sm-offset-3" style="text-align: center; margin: 0 auto">
                                    <!--<button class="btn btn-primary">保存</button>&nbsp;-->
                                    <button type="button" class="btn btn-primary" id="newSchemeBtn">保存</button>&nbsp;
                                    <button class="btn btn-default" onclick="javascript:history.go(-1);">
                                        取消
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div><!-- panel-footer -->
                </div><!-- panel -->
            </form>

        </div><!-- contentpanel -->

    </div><!-- mainpanel -->

</section>


<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/jquery.sparkline.min.js"></script>
<script src="js/toggles.min.js"></script>
<script src="js/retina.min.js"></script>
<script src="js/jquery.cookies.js"></script>

<script src="js/select2.min.js"></script>

<script src="js/custom.js"></script>
<script src="js/when.js"></script>
<script src="js/sweetalert.min.js"></script>
<script src="js/bootstrap-select.js"></script>

<script th:inline="javascript">

    window.myStorage = {
        locationId: -1,
    };

    <!-- 加载共同头部 -->
    $(function () {
        $('.left').load("left");
        $('.head').load("head")
    });

    jQuery(document).ready(function () {

        "use strict";

        // Delete row in a table
        jQuery('.delete-row').click(function () {
            alert("delete row");
            var c = confirm("Continue delete?");
            if (c)
                jQuery(this).closest('.panel').fadeOut(function () {
                    jQuery(this).remove();
                });

            return false;
        });

        new When({
            input: document.getElementById('date')
        });

        // Select2
        jQuery(".select2").select2({
            width: '100%',
            minimumResultsForSearch: -1
        });

    });


    $(function () {
        $('#newSchemeBtn').click(function () {
            var schemeType = $('#schemeType option:selected').val();
            var schemeDirection = $('#schemeDirection option:selected').val();
            var longitude = $('#longitude').val();
            var latitude = $('#latitude').val();
            //  将经纬度存入全局变量
            localStorage.setItem("lng", longitude);
            localStorage.setItem("lat", latitude);
            var carryPattern = $('#carryPattern option:selected').text();
            var protectionPattern = $('#protectionPattern option:selected').text();
            var date = $('#date').val();
            var schemeCode = $('#schemeCode').val();
            var platoonId = $('#platoonId option:selected').val();
            var platoonName = $('#platoonId option:selected').text();
            console.log(platoonId);
            localStorage.setItem("platoon_id", platoonId);
            localStorage.setItem("platoon_name", platoonName);

            //  切割date日期字符串，得到任务开始时间与结束时间
            var dateStr = date.split(' ');
            var schemeBeginTime = dateStr[0];
            var schemeEndTime = dateStr[2];
            console.log(schemeBeginTime);
            console.log(schemeEndTime);

            //  切割任务开始时间字符串，得到开始时间的月份
            var monthStr = schemeBeginTime.split('-');
            var month = monthStr[1];
            localStorage.setItem("month", month);

            var location = {
                longitude: parseInt(longitude),
                latitude: parseInt(latitude)
            };
            var scheme = {
                scheme_type: schemeType,
                combat_direction: schemeDirection,
                scheme_code: schemeCode,
                scheme_begin_time: schemeBeginTime,
                scheme_end_time: schemeEndTime,
                carry_method: carryPattern,
                safeguard_mode: protectionPattern
            };
            var request = {
                location: location,
                scheme: scheme
            };

            schemeStr = JSON.stringify(request);


            $.ajax({
                type: 'POST',
                data: schemeStr,
                contentType: "application/json;charset=UTF-8",
                url: "/AddSchemeMsg",
                dataType: "json",
                async: false,     // 取消异步加载
                success: function (data) {
                    alert("scheme" + data.scheme_id);
                    window.location.href = "/ShowMap";
                    localStorage.setItem("scheme_id", data.scheme_id);
                },
                error: function () {
                    console.error("error");

                }
            })


        })

    })

</script>

</body>
</html>
